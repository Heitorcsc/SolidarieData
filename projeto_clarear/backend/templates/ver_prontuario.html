<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prontuário de {{ prontuario.nome_paciente }}</title>

    <!-- 1. Script do Tailwind CSS (agora com o plugin 'forms') -->
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>

    <!-- 2. Script do Modo Noturno (O Cérebro) -->
    <script>
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark')
        } else {
            document.documentElement.classList.remove('dark')
        }
        function toggleTheme() {
            if (localStorage.theme === 'dark') {
                localStorage.theme = 'light'
                document.documentElement.classList.remove('dark')
            } else {
                localStorage.theme = 'dark'
                document.documentElement.classList.add('dark')
            }
        }
    </script>

    <!-- 3. Configuração das Cores (Sem o 'require') -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'solidarie-primary': '#2F6A6D',
                        'solidarie-secondary': '#AEC5D0',
                    }
                }
            }
            // O plugin 'forms' já foi carregado no script principal
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Converte quebras de linha (salvas no DB) em quebras de linha (HTML) */
        .whitespace-pre-wrap {
            white-space: pre-wrap;
        }
    </style>
</head>

<body class="bg-gray-100 dark:bg-gray-900">

    <div class="container mx-auto max-w-4xl my-12 px-4">

        <!-- Botão de Modo Noturno -->
        <div class="absolute top-5 right-5">
            <button onclick="toggleTheme()"
                class="p-2 rounded-full text-gray-600 dark:text-gray-300 bg-white dark:bg-slate-800 shadow-md hover:bg-gray-100 dark:hover:bg-slate-700">
                <span class="dark:hidden"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                        fill="currentColor" class="bi bi-moon-fill" viewBox="0 0 16 16">
                        <path
                            d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z" />
                    </svg></span>
                <span class="hidden dark:inline"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                        fill="currentColor" class="bi bi-brightness-high-fill" viewBox="0 0 16 16">
                        <path
                            d="M12 8a4 4 0 1 1-8 0 4 4 0 0 1 8 0zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z" />
                    </svg></span>
            </button>
        </div>

        <div class="bg-white dark:bg-gray-800 p-8 md:p-12 rounded-xl shadow-lg space-y-10">

            <!-- Cabeçalho -->
            <div class="flex justify-between items-start">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-100">{{ prontuario.nome_paciente }}</h1>
                    <p class="text-gray-600 dark:text-gray-400 mt-2">Paciente ID: {{ prontuario.id }}</p>
                </div>
                <a href="{{ url_for('index') }}"
                    class="text-sm text-solidarie-primary dark:text-solidarie-secondary hover:underline">&larr; Voltar
                    para a lista</a>
            </div>

            <!-- Bloco de Mensagens Flash -->
            {% with messages = get_flashed_messages() %}
            {% if messages %}
            <div class="bg-green-100 dark:bg-green-900 border-l-4 border-green-500 text-green-700 dark:text-green-200 p-4"
                role="alert">
                <p class="font-bold">{{ messages[0] }}</p>
            </div>
            {% endif %}
            {% endwith %}

            <!-- Formulário de ACOMPANHAMENTO -->
            <form method="POST">
                <fieldset>
                    <legend
                        class="text-xl font-semibold text-solidarie-primary dark:text-solidarie-secondary mb-4 border-b border-gray-300 dark:border-gray-600 pb-2">
                        Acompanhamento Médico</legend>
                    <label for="nova_observacao"
                        class="block text-sm font-medium text-gray-700 dark:text-gray-300">Adicionar nova
                        observação:</label>
                    <textarea name="nova_observacao" id="nova_observacao" rows="6"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-solidarie-primary focus:ring-solidarie-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                        placeholder="Digite a evolução do paciente, nova medicação, etc..."></textarea>
                    <button type="submit"
                        class="mt-4 inline-flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-solidarie-primary hover:bg-opacity-90">
                        Adicionar ao Histórico
                    </button>
                </fieldset>
            </form>

            <!-- Histórico de Observações -->
            <fieldset>
                <legend
                    class="text-xl font-semibold text-solidarie-primary dark:text-solidarie-secondary mb-4 border-b border-gray-300 dark:border-gray-600 pb-2">
                    Histórico de Observações</legend>
                <div
                    class="bg-gray-50 dark:bg-gray-900 p-4 rounded-md border border-gray-200 dark:border-gray-700 max-h-96 overflow-y-auto">
                    {% if prontuario.observacoes_medicas %}
                    <p class="text-gray-700 dark:text-gray-300 text-sm whitespace-pre-wrap">{{
                        prontuario.observacoes_medicas }}</p>
                    {% else %}
                    <p class="text-gray-500 dark:text-gray-400 text-sm">Nenhuma observação inicial registrada.</p>
                    {% endif %}
                </div>
            </fieldset>

            <!-- Detalhes do Paciente -->
            <fieldset>
                <legend
                    class="text-xl font-semibold text-solidarie-primary dark:text-solidarie-secondary mb-6 border-b border-gray-300 dark:border-gray-600 pb-2">
                    Dados Cadastrais do Paciente</legend>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4 text-sm text-gray-700 dark:text-gray-300">
                    <div><strong class="text-gray-600 dark:text-gray-400">Nome:</strong> {{ prontuario.nome_paciente }}
                    </div>
                    <div><strong class="text-gray-600 dark:text-gray-400">Idade:</strong> {{ prontuario.idade or 'N/I'
                        }}</div>
                    <div><strong class="text-gray-600 dark:text-gray-400">Telefone:</strong> {{ prontuario.telefone or
                        'N/I' }}</div>
                    <div><strong class="text-gray-600 dark:text-gray-400">Profissão:</strong> {{ prontuario.profissao or
                        'N/I' }}</div>
                    <div class="md:col-span-2"><strong class="text-gray-600 dark:text-gray-400">Endereço:</strong> {{
                        prontuario.endereco_paciente or 'N/I' }}</div>
                    <div><strong class="text-gray-600 dark:text-gray-400">Bairro:</strong> {{ prontuario.bairro or 'N/I'
                        }}</div>
                    <div><strong class="text-gray-600 dark:text-gray-400">Cidade:</strong> {{ prontuario.cidade or 'N/I'
                        }}</div>
                    <div><strong class="text-gray-600 dark:text-gray-400">Convênio:</strong> {{ prontuario.convenio or
                        'N/I' }}</div>
                </div>
            </fieldset>

            <!-- Detalhes da Anamnese -->
            <fieldset>
                <legend
                    class="text-xl font-semibold text-solidarie-primary dark:text-solidarie-secondary mb-6 border-b border-gray-300 dark:border-gray-600 pb-2">
                    Ficha de Anamnese (Resumo)</legend>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4 text-sm text-gray-700 dark:text-gray-300">
                    <div><strong class="text-gray-600 dark:text-gray-400">Data Nasc.:</strong> {{
                        prontuario.data_nascimento.strftime('%d/%m/%Y') if prontuario.data_nascimento else 'N/I' }}
                    </div>
                    <div><strong class="text-gray-600 dark:text-gray-400">Tipo Sanguíneo:</strong> {{
                        prontuario.tipo_sanguineo or 'N/I' }}</div>
                    <div><strong class="text-gray-600 dark:text-gray-400">Contato Emergência:</strong> {{
                        prontuario.contato_emergencia_nome or 'N/I' }}</div>
                    <div><strong class="text-gray-600 dark:text-gray-400">Telefone Emergência:</strong> {{
                        prontuario.contato_emergencia_telefone or 'N/I' }}</div>
                    <div><strong class="text-gray-600 dark:text-gray-400">Seguro Saúde:</strong> {{
                        prontuario.tem_seguro or 'N/I' }}</div>
                    <div><strong class="text-gray-600 dark:text-gray-400">Fumante:</strong> {{ prontuario.fumante or
                        'N/I' }}</div>
                    <div><strong class="text-gray-600 dark:text-gray-400">Condição Física:</strong> {{
                        prontuario.condicao_fisica or 'N/I' }}</div>
                    <div class="md:col-span-2"><strong class="text-gray-600 dark:text-gray-400">Alergias:</strong> {{
                        prontuario.alergia_descricao or 'Nenhuma' }}</div>
                    <div class="md:col-span-2"><strong class="text-gray-600 dark:text-gray-400">Restrições
                            Alim.:</strong> {{ prontuario.alimento_restricao or 'Nenhuma' }}</div>
                    <div class="md:col-span-2"><strong class="text-gray-600 dark:text-gray-400">Medicamentos:</strong>
                        {{ prontuario.medicamento_descricao or 'Nenhum' }}</div>
                </div>
            </fieldset>

        </div>
    </div>

</body>

</html>