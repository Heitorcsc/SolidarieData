<!doctype html>
<html class="h-full">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Script do Modo Noturno (O Cérebro) -->
    <script>
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark')
        } else {
            document.documentElement.classList.remove('dark')
        }
        function toggleTheme() {
            if (localStorage.theme === 'dark') {
                localStorage.theme = 'light'
                document.documentElement.classList.remove('dark')
            } else {
                localStorage.theme = 'dark'
                document.documentElement.classList.add('dark')
            }
        }
    </script>

    <!-- Configuração das Cores "SolidarieData" -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'solidarie-primary': '#2F6A6D',
                        'solidarie-secondary': '#AEC5D0',
                    }
                }
            },
            plugins: [
                require('@tailwindcss/forms'),
            ],
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
    <title>Dashboard - SolidarieData</title>
</head>

<!-- Layout de Dashboard com Sidebar -->

<body class="h-full bg-gray-100 dark:bg-slate-900">
    <div class="flex h-full">

        <!-- Sidebar (Barra Lateral Fixa) -->
        <div class="w-64 flex flex-col justify-between bg-solidarie-primary dark:bg-gray-900 text-white shadow-lg">
            <div>
                <!-- Logo -->
                <div class="p-6 text-center">
                    <a href="{{ url_for('index') }}"
                        class="text-2xl font-bold text-white dark:text-solidarie-secondary">SolidarieData</a>
                </div>

                <!-- Links de Navegação -->
                <nav class="mt-6">
                    <a href="{{ url_for('index') }}"
                        class="flex items-center px-6 py-3 bg-gray-700 dark:bg-gray-700 bg-opacity-50 text-solidarie-secondary dark:text-white">
                        <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                        <span class="ml-3">Pacientes</span>
                    </a>
                    <a href="{{ url_for('criar_prontuario') }}"
                        class="flex items-center px-6 py-3 text-gray-200 hover:bg-gray-700 dark:hover:bg-gray-700 hover:bg-opacity-50">
                        <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <span class="ml-3">Adicionar Paciente</span>
                    </a>
                </nav>
            </div>

            <!-- Seção Inferior da Sidebar -->
            <div class="p-4 border-t border-solidarie-secondary border-opacity-30">
                <div class="flex items-center justify-between">
                    <!-- Botão de Sair -->
                    <a href="{{ url_for('logout') }}" class="flex items-center text-sm text-gray-200 hover:text-white"
                        title="Sair">
                        <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                        </svg>
                        <span class="ml-2">Sair</span>
                    </a>

                    <!-- Botão de Modo Noturno -->
                    <button onclick="toggleTheme()"
                        class="p-2 rounded-full text-gray-200 hover:bg-gray-700 hover:bg-opacity-50" title="Mudar Tema">
                        <span class="dark:hidden"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                fill="currentColor" class="bi bi-moon-fill" viewBox="0 0 16 16">
                                <path
                                    d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z" />
                            </svg></span>
                        <span class="hidden dark:inline"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                fill="currentColor" class="bi bi-brightness-high-fill" viewBox="0 0 16 16">
                                <path
                                    d="M12 8a4 4 0 1 1-8 0 4 4 0 0 1 8 0zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z" />
                            </svg></span>
                    </button>
                </div>
                <div class="mt-4 text-center text-xs text-gray-300 dark:text-gray-500">
                    Logado como:<br> {{ user.nome_ong }}
                </div>
            </div>
        </div>

        <!-- Conteúdo Principal -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <header class="bg-white dark:bg-slate-800 shadow-md p-4">
                <h1 class="text-2xl font-bold text-gray-800 dark:text-white">Dashboard de Pacientes</h1>
            </header>

            <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 dark:bg-slate-900 p-6">

                <!-- Mensagens Flash (ex: Prontuário não encontrado) -->
                {% with messages = get_flashed_messages() %}
                {% if messages %}
                <div class="bg-blue-100 dark:bg-blue-900 border-l-4 border-blue-500 text-blue-700 dark:text-blue-200 p-4 mb-4 rounded"
                    role="alert">
                    {{ messages[0] }}
                </div>
                {% endif %}
                {% endwith %}

                <!-- BARRA DE BUSCA -->
                <div class="mb-6">
                    <form method="GET" action="{{ url_for('index') }}" class="flex">
                        <input type="text" name="search_query"
                            class="flex-1 p-3 rounded-l-md border border-gray-300 dark:bg-slate-700 dark:border-slate-600 dark:text-white focus:outline-none focus:ring-2 focus:ring-solidarie-primary"
                            placeholder="Buscar por nome ou telefone..." value="{{ search_query or '' }}">
                        <button type="submit"
                            class="p-3 bg-solidarie-primary text-white rounded-r-md hover:bg-opacity-90">
                            <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                    </form>
                </div>

                <!-- Lista de Prontuários (convertida para Tailwind) -->
                <div class="space-y-4">
                    {% for prontuario in prontuarios %}
                    <div class="bg-white dark:bg-slate-800 shadow-md rounded-lg p-5 transition hover:shadow-lg">
                        <div class="flex w-full justify-between">
                            <h5 class="text-lg font-semibold text-solidarie-primary dark:text-solidarie-secondary mb-1">
                                {{ prontuario.nome_paciente }}</h5>
                            <small class="text-gray-500 dark:text-gray-400">Cadastrado em: {{
                                prontuario.created_at.strftime('%d/%m/%Y') }}</small>
                        </div>
                        <p class="mb-2 text-gray-700 dark:text-gray-300">Telefone: {{ prontuario.telefone or 'Não
                            informado' }}</p>
                        <small class="text-gray-600 dark:text-gray-400">Convênio: {{ prontuario.convenio or 'Não
                            informado' }}</small>

                        <div class="mt-4">
                            <a href="{{ url_for('ver_prontuario', prontuario_id=prontuario.id) }}"
                                class="py-2 px-3 bg-solidarie-primary text-white text-sm font-medium rounded-md hover:bg-opacity-90">
                                Ver Prontuário
                            </a>

                            <!-- Botão de Excluir -->
                            <form action="{{ url_for('delete_prontuario', prontuario_id=prontuario.id) }}" method="POST"
                                class="inline-block ml-2">
                                <button type="submit"
                                    onclick="return confirm('Tem certeza que deseja excluir este prontuário? Esta ação não pode ser desfeita.')"
                                    class="py-2 px-3 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700">
                                    Excluir
                                </button>
                            </form>
                        </div>
                    </div>
                    {% else %}
                    <!-- Mensagem se a lista (ou a busca) estiver vazia -->
                    <div class="bg-yellow-100 dark:bg-slate-700 border-l-4 border-yellow-500 text-yellow-700 dark:text-yellow-200 p-4"
                        role="alert">
                        {% if search_query %}
                        Nenhum paciente encontrado para a busca "{{ search_query }}".
                        {% else %}
                        Você ainda não cadastrou nenhum paciente.
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>

            </main>
        </div>
    </div>
</body>

</html>